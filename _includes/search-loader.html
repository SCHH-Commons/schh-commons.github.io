{% capture result_elem %}
<article class="px-1 px-sm-2 px-lg-4 px-xl-0">
  <header>
    <h2><a href="{url}">{title}</a></h2>
    <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">
      {categories}
      {tags}
    </div>
  </header>
  <p>{content}</p>
</article>
{% endcapture %}

{% capture not_found %}<p class="mt-5">{{ site.data.locales[include.lang].search.no_results }}</p>{% endcapture %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchData = [
      {% for article in site.articles %}
      {
        "title": {{ article.title | jsonify }},
        "url": {{ article.url | relative_url | jsonify }},
        "categories": {{ article.categories | join: ", " | jsonify }},
        "tags": {{ article.tags | join: ", " | jsonify }},
        "content": {{ article.content | strip_html | strip_newlines | truncatewords: 200 | jsonify }}
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}{% for map in site.maps %},
      {
        "title": {{ map.title | jsonify }},
        "url": {{ map.url | relative_url | jsonify }},
        "categories": {{ map.categories | join: ", " | jsonify }},
        "tags": {{ map.tags | join: ", " | jsonify }},
        "content": {{ map.content | strip_html | strip_newlines | truncatewords: 200 | jsonify }}
      }{% endfor %}{% for podcast in site.podcasts %},
      {
        "title": {{ podcast.title | jsonify }},
        "url": {{ podcast.url | relative_url | jsonify }},
        "categories": {{ podcast.categories | join: ", " | jsonify }},
        "tags": {{ podcast.tags | join: ", " | jsonify }},
        "content": {{ podcast.content | strip_html | strip_newlines | truncatewords: 200 | jsonify }}
      }{% endfor %}{% for tab in site.tabs %}{% if tab.content and tab.content != "" %},
      {
        "title": {{ tab.title | jsonify }},
        "url": {{ tab.url | relative_url | jsonify }},
        "categories": "",
        "tags": "",
        "content": {{ tab.content | strip_html | strip_newlines | truncatewords: 200 | jsonify }}
      }{% endif %}{% endfor %}
    ];

  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: searchData,
    searchResultTemplate: '{{ result_elem | strip_newlines }}',
    noResultsText: '{{ not_found }}',
    templateMiddleware: function (prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
  });
</script>